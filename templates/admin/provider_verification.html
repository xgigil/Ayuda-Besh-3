<!-- templates/admin/provider_verification.html -->
{% extends "base.html" %}

{% block title %}Provider Verification - AyudaBesh{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h1>Provider Verification</h1>
        <button onclick="window.location.href='/admin/dashboard'" 
                style="background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 4px;">
            ← Back to Dashboard
        </button>
    </div>

    <div id="pendingProviders" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3>Pending Verification</h3>
        <p>Loading providers...</p>
    </div>

    <div id="verifiedProviders" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-top: 20px;">
        <h3>Verified Providers</h3>
        <p>Loading providers...</p>
    </div>
</div>

<script>
async function loadProviders() {
    const token = localStorage.getItem('token');
    if (!token) return;
    
    try {
        // In a real app, you'd have separate endpoints for pending/verified
        // For now, we'll simulate with mock data
        
        const pendingHtml = `
            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Name</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Service</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Documents</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 12px;">Maria Santos</td>
                        <td style="padding: 12px;">Electrical Work</td>
                        <td style="padding: 12px;">
                            <a href="#" style="color: #0070f3;">View ID</a> | 
                            <a href="#" style="color: #0070f3;">View Certificate</a>
                        </td>
                        <td style="padding: 12px;">
                            <button onclick="verifyProvider('provider123')" 
                                    style="background: #28a745; color: white; padding: 6px 12px; border: none; border-radius: 4px; font-size: 12px; margin-right: 5px;">
                                Verify
                            </button>
                            <button onclick="rejectProvider('provider123')" 
                                    style="background: #d9534f; color: white; padding: 6px 12px; border: none; border-radius: 4px; font-size: 12px;">
                                Reject
                            </button>
                        </td>
                    </tr>
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 12px;">John Dela Cruz</td>
                        <td style="padding: 12px;">Plumbing</td>
                        <td style="padding: 12px;">
                            <a href="#" style="color: #0070f3;">View ID</a> | 
                            <a href="#" style="color: #0070f3;">View Certificate</a>
                        </td>
                        <td style="padding: 12px;">
                            <button onclick="verifyProvider('provider456')" 
                                    style="background: #28a745; color: white; padding: 6px 12px; border: none; border-radius: 4px; font-size: 12px; margin-right: 5px;">
                                Verify
                            </button>
                            <button onclick="rejectProvider('provider456')" 
                                    style="background: #d9534f; color: white; padding: 6px 12px; border: none; border-radius: 4px; font-size: 12px;">
                                Reject
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        `;
        
        const verifiedHtml = `
            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Name</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Service</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Rating</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 12px;">Carlos Reyes</td>
                        <td style="padding: 12px;">Domestic Cleaning</td>
                        <td style="padding: 12px;">⭐ 4.8/5</td>
                        <td style="padding: 12px;">
                            <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                                Verified
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        `;
        
        document.getElementById('pendingProviders').innerHTML = '<h3>Pending Verification</h3>' + pendingHtml;
        document.getElementById('verifiedProviders').innerHTML = '<h3>Verified Providers</h3>' + verifiedHtml;
    } catch (error) {
        console.error('Error loading providers:', error);
    }
}

async function verifyProvider(providerId) {
    if (!confirm('Verify this provider?')) return;
    
    const token = localStorage.getItem('token');
    try {
        const response = await fetch(`/api/admin/verify-provider/${providerId}`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (response.ok) {
            alert('Provider verified successfully!');
            loadProviders();
        } else {
            const error = await response.json();
            alert('Error: ' + (error.error || 'Failed to verify provider'));
        }
    } catch (error) {
        alert('Network error. Please try again.');
    }
}

function rejectProvider(providerId) {
    if (!confirm('Reject this provider?')) return;
    alert('Feature coming soon: Provider rejection with reason');
}

// Initialize
document.addEventListener('DOMContentLoaded', loadProviders);
</script>
{% endblock %}