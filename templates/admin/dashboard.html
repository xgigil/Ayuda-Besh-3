<!-- templates/admin/dashboard.html -->
{% extends "base.html" %}

{% block title %}Admin Dashboard - AyudaBesh{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h1>Admin Dashboard</h1>
        <button onclick="logout()" 
                style="background: #d9534f; color: white; padding: 12px 24px; border: none; border-radius: 4px;">
            Logout
        </button>
    </div>

    <!-- Welcome Section -->
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
        <h2>Welcome, Admin!</h2>
        <p>Manage providers, resolve disputes, and monitor platform activity.</p>
    </div>

    <!-- Admin Stats -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
            <h3 style="margin: 0 0 10px 0; color: #0070f3;"><span id="totalBookings">0</span></h3>
            <p>Total Bookings</p>
        </div>
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
            <h3 style="margin: 0 0 10px 0; color: #28a745;"><span id="activeProviders">0</span></h3>
            <p>Active Providers</p>
        </div>
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
            <h3 style="margin: 0 0 10px 0; color: #17a2b8;"><span id="totalCustomers">0</span></h3>
            <p>Total Customers</p>
        </div>
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
            <h3 style="margin: 0 0 10px 0; color: #ffc107;"><span id="openDisputes">0</span></h3>
            <p>Open Disputes</p>
        </div>
    </div>

    <!-- Admin Quick Actions -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h3>üë• Provider Verification</h3>
            <p>Review and verify new service providers.</p>
            <button onclick="window.location.href='/admin/provider-verification'" 
                    style="background: #0070f3; color: white; padding: 8px 16px; border: none; border-radius: 4px; margin-top: 10px;">
                Verify Providers
            </button>
        </div>
        
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h3>‚öñÔ∏è Dispute Resolution</h3>
            <p>Handle customer-provider disputes and issues.</p>
            <button onclick="window.location.href='/admin/dispute-management'" 
                    style="background: #d9534f; color: white; padding: 8px 16px; border: none; border-radius: 4px; margin-top: 10px;">
                Manage Disputes
            </button>
        </div>
        
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h3>üìä Reports</h3>
            <p>Generate and view platform analytics reports.</p>
            <button onclick="window.location.href='/admin/reports'" 
                    style="background: #17a2b8; color: white; padding: 8px 16px; border: none; border-radius: 4px; margin-top: 10px;">
                View Reports
            </button>
        </div>
    </div>

    <!-- Recent Activity -->
    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3>Recent Activity</h3>
        <div id="adminActivity" style="margin-top: 20px;">
            <p>Loading recent activity...</p>
        </div>
    </div>
</div>

<script>
async function loadAdminData() {
    const token = localStorage.getItem('token');
    if (!token) return;
    
    try {
        // Load stats
        const statsResponse = await fetch('/api/admin/reports/daily-bookings', {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (statsResponse.ok) {
            const bookings = await statsResponse.json();
            document.getElementById('totalBookings').textContent = bookings.length;
            
            // Mock other stats (in real app, you'd have separate endpoints)
            document.getElementById('activeProviders').textContent = '24';
            document.getElementById('totalCustomers').textContent = '156';
            document.getElementById('openDisputes').textContent = '3';
        }
        
        // Load recent activity (mock data)
        document.getElementById('adminActivity').innerHTML = `
            <div style="display: grid; gap: 15px;">
                <div style="border-left: 4px solid #0070f3; padding-left: 15px;">
                    <p><strong>New provider registration</strong> - Maria Santos (Electrical Work)</p>
                    <small>2 hours ago</small>
                </div>
                <div style="border-left: 4px solid #ffc107; padding-left: 15px;">
                    <p><strong>Dispute opened</strong> - Booking #BK789 (Customer vs Provider)</p>
                    <small>4 hours ago</small>
                </div>
                <div style="border-left: 4px solid #28a745; padding-left: 15px;">
                    <p><strong>Provider verified</strong> - John Dela Cruz (Plumbing)</p>
                    <small>6 hours ago</small>
                </div>
            </div>
        `;
    } catch (error) {
        console.error('Error loading admin data:', error);
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', loadAdminData);
</script>
{% endblock %}